# ๐ง ุฅุตูุงุญ RLS Policies ูุฌุฏูู requests

## โ ูุง ุชู ุงูุชุญูู ููู

ูู ุงูุตูุฑุฉุ RLS Policies ูุฌุฏูู `profiles` ููุฌูุฏุฉ ูุตุญูุญุฉ. ุงูุขู ูุญุชุงุฌ ุงูุชุญูู ูู ุฌุฏูู `requests`.

---

## ๐ ุงูุฎุทูุฉ 1: ุงูุชุญูู ูู RLS Policies ูุฌุฏูู requests

1. ุงุฐูุจ ุฅูู: https://app.supabase.com/project/gfjtyfwwbpjbwafbnfcc
2. **SQL Editor** โ **New Query**
3. ุงูุณุฎ ูุญุชูู ููู: `supabase/CHECK_REQUESTS_RLS.sql`
4. ุงูุตูู ูู SQL Editor
5. ุงุถุบุท **Run**

ูุฐุง ุณูุนุฑุถ:
- RLS Policies ุงูููุฌูุฏุฉ ูุฌุฏูู `requests`
- ุญุงูุฉ RLS (ููุนูู ุฃู ูุง)
- ุงูุฃุนูุฏุฉ ุงูููุฌูุฏุฉ ูู ุงูุฌุฏูู

---

## ๐ง ุงูุฎุทูุฉ 2: ุฅุตูุงุญ RLS Policies (ุฅุฐุง ูุงูุช ููููุฏุฉ)

ุฅุฐุง ูู ุชูู ููุงู RLS Policies ูุฌุฏูู `requests`:

1. ูู **SQL Editor** โ **New Query**
2. ุงูุณุฎ ูุญุชูู ููู: `supabase/FIX_ALL_RLS_NOW.sql`
3. ุงูุตูู ูู SQL Editor
4. ุงุถุบุท **Run**

ูุฐุง ุณููุดุฆ:
- โ SELECT policy: ุงูุฌููุน ูููููู ูุฑุงุกุฉ ุงูุทูุจุงุช ุงูุนุงูุฉ
- โ SELECT policy: ุงููุณุชุฎุฏููู ูููููู ุฑุคูุฉ ุทูุจุงุชูู
- โ INSERT policy: ุงููุณุชุฎุฏููู ูููููู ุฅูุดุงุก ุทูุจุงุช (ูุน `auth.uid() = author_id`)
- โ UPDATE policy: ุงููุณุชุฎุฏููู ูููููู ุชุญุฏูุซ ุทูุจุงุชูู
- โ DELETE policy: ุงููุณุชุฎุฏููู ูููููู ุญุฐู ุทูุจุงุชูู

---

## โ๏ธ ุงููุดููุฉ ุงููุญุชููุฉ

ูู ุงูููุฏุ ุฃุฑู ุฃู:
- `payload.author_id = userId;` (ุงูุณุทุฑ 329 ูู `requestsService.ts`)

ุงููุดููุฉ ูุฏ ุชููู:
1. **ุงููุณุชุฎุฏู ุบูุฑ ูุณุฌู ุฏุฎูู** (`auth.uid()` = `null`)
2. **`author_id` ูุง ูุณุงูู `auth.uid()`** ุนูุฏ ุงูุฅุฏุฑุงุฌ
3. **RLS Policy ุบูุฑ ููุฌูุฏุฉ** ูุฌุฏูู `requests`

---

## ๐ ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู

ุงูุชุญ Console (F12) ูุงุจุญุซ ุนู:
- `auth.uid()` - ูุฌุจ ุฃู ูููู ููุฌูุฏุงู
- `author_id` - ูุฌุจ ุฃู ูุณุงูู `auth.uid()`

---

## โ Checklist

ูุจู ุงูุงุฎุชุจุงุฑุ ุชุฃูุฏ ูู:

- [ ] ุฌุฏูู `requests` ููุฌูุฏ
- [ ] RLS ููุนูู ุนูู ุฌุฏูู `requests`
- [ ] INSERT policy ููุฌูุฏุฉ ูุฌุฏูู `requests`
- [ ] ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู (`auth.uid()` ููุฌูุฏ)
- [ ] `author_id` ูู ุงูุทูุจ ูุณุงูู `auth.uid()`

---

## ๐งช ุงุฎุชุจุงุฑ

ุจุนุฏ ุชุทุจูู RLS Policies:

1. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ (F5)
2. ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู
3. ุฌุฑุจ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
4. ูุฌุจ ุฃู ูุนูู ุงูุขู

---

## ๐ ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ

ุงูุชุญ Console (F12) ูุงุจุญุซ ุนู:
- `โ Supabase Insert Error`
- `permission` ุฃู `policy` ุฃู `RLS`
- `author_id` - ุชุญูู ูู ูููุชู

ุดุงุฑู ูุนู:
1. ูุชูุฌุฉ `CHECK_REQUESTS_RLS.sql`
2. ุฑุณุงูุฉ ุงูุฎุทุฃ ูู Console
3. ูู ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎููุ
