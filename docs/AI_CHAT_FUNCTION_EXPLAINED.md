# ุดุฑุญ Function: ai-chat

## ๐ฏ ุงููุธููุฉ ุงููุนููุฉ

`ai-chat` **ููุณ** ููุญุงุฏุซุงุช ูุน ุงูุฐูุงุก ุงูุงุตุทูุงุนูุ ุจู **ูุฅูุดุงุก ุนููุงู ูุชุตููู ุชููุงุฆู** ููุทูุจุงุช.

---

## ๐ ููู ูุนูู

### 1. **ุงููุฏุฎู (Input)**
ูู Frontend ูุชู ุฅุฑุณุงู:
```json
{
  "prompt": "ุฌูุจ ููุฒุณ 2005",
  "mode": "draft",
  "chatHistory": [] // ูุงุฑุบ ุฃู ูุตูุฑ
}
```

### 2. **ุงููุนุงูุฌุฉ**
- ุงูู AI ูุญูู ุงููุต
- ููุดุฆ ุนููุงู ููุงุณุจ (ูุซู: "ูุทููุจ ุฌูุจ ููุฒุณ 2005")
- ูุตูู ุงูุทูุจ (ูุซู: ["ุตูุงูุฉ ุณูุงุฑุงุช"])

### 3. **ุงููุฎุฑุฌ (Output)**
```json
{
  "title": "ูุทููุจ ุฌูุจ ููุฒุณ 2005",
  "categories": ["ุตูุงูุฉ ุณูุงุฑุงุช"],
  "timestamp": "2025-01-26T..."
}
```

---

## ๐ ุงููุถุนูู (Modes)

### โ ุงููุถุน ุงูููุณุชุฎุฏู: `draft`
- **ุงููุธููุฉ**: ุนูููุฉ ูุชุตููู ููุท
- **ุงููุฏุฎู**: ูุต ุจุณูุท ูู ุงููุณุชุฎุฏู
- **ุงููุฎุฑุฌ**: `title` + `categories`

### โ๏ธ ุงููุถุน ุบูุฑ ุงููุณุชุฎุฏู: `chat` (ุงูุชุฑุงุถู)
- **ุงููุธููุฉ**: ูุญุงุฏุซุฉ ุชูุงุนููุฉ ูุฌูุน ูุนูููุงุช
- **ุงููุฏุฎู**: ุฑุณุงุฆู ูุชุนุฏุฏุฉ ูุน history
- **ุงููุฎุฑุฌ**: `title`, `city`, `description_brief`, `is_ready_to_send`
- **ููุงุญุธุฉ**: ูุฐุง ุงููุถุน ููุฌูุฏ ูู ุงูููุฏ ููู **ูุง ููุณุชุฎุฏู** ูู ุงูุชุทุจูู ุญุงููุงู

---

## ๐ ุฃูู ููุณุชุฎุฏู ูู ุงูููุฏุ

### ูู Frontend:
```typescript
// services/aiService.ts
export async function generateDraftWithCta(text: string) {
  const { data } = await supabase.functions.invoke("ai-chat", {
    body: { 
      prompt: text,
      mode: "draft",  // โก ุฏุงุฆูุงู draft
      chatHistory: []
    }
  });
  return data; // { title, categories }
}
```

### ูู Components:
- `components/CreateRequestV2.tsx` - ุนูุฏ ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ
- ุงููุณุชุฎุฏู ููุชุจ ูุต โ AI ููุดุฆ ุนููุงู ูุชุตูููุงุช ุชููุงุฆูุงู

---

## โ ุงูุฎูุงุตุฉ

| ุงูุณุคุงู | ุงูุฅุฌุงุจุฉ |
|--------|---------|
| ูู `ai-chat` ูููุญุงุฏุซุงุชุ | โ ูุง - ููุท ููุนูููุฉ ูุงูุชุตููู |
| ูู ูุญุชุงุฌู ูู ุงููุดุฑูุน ุงูุฌุฏูุฏุ | โ ูุนู - ููู ุฌุฏุงู ูุฅูุดุงุก ุงูุทูุจุงุช |
| ูุงุฐุง ููุนู ุจุงูุถุจุทุ | ููุดุฆ ุนููุงู ููุตูู ุงูุทูุจ ูู ูุต ุงููุณุชุฎุฏู |
| ูู ูุญุชุงุฌ ุชุงุฑูุฎ ูุญุงุฏุซุงุชุ | โ ูุง - ูุนูู ูุน ูุต ูุงุญุฏ ููุท |

---

## ๐ง Secrets ุงููุทููุจุฉ

```
ANTHROPIC_API_KEY=sk-ant-xxxxx  (ุฃู OPENAI_API_KEY)
SUPABASE_URL=https://...
SUPABASE_SERVICE_ROLE_KEY=...
```

**ุจุฏูู ูุฐู Keys**: Function ูุง ูุนููุ ููู ุงูุชุทุจูู ูู ูุชููู (ุณูุณุชุฎุฏู fallback)

---

## ๐ก ูุตูุญุฉ

ุงุณู `ai-chat` ูุถูู ููููุงู - ุงููุธููุฉ ุงููุนููุฉ ูู **"generate-draft"** ุฃู **"classify-request"** ููู ุงูุงุณู ุงูุญุงูู ููุฌูุฏ ูู ุงูููุฏ ูููููู ุงูุฅุจูุงุก ุนููู.

**ููููู:**
- โ ุงูุฅุจูุงุก ุนูู `ai-chat` (ููุชูุงูู ูุน ุงูููุฏ ุงููุฏูู)
- ุฃู โ๏ธ ุฅุนุงุฏุฉ ุชุณููุชู ูู `generate-draft` (ูุญุชุงุฌ ุชุญุฏูุซ Frontend)

---

**ุชู: 2025-01-26**
