# إصلاح مشكلة "انتهت صلاحية رمز التحقق"

## المشكلة

عند استخدام رقم اختبار (0555111111 أو 0555222222) والرمز 0000، قد تظهر رسالة "انتهت صلاحية رمز التحقق".

## الحل المطبق

تم تحسين الكود لمعالجة هذه المشكلة:

### 1. إعادة إرسال OTP تلقائياً
- عند انتهاء صلاحية OTP للأرقام الاختبارية، يتم إرسال OTP جديد تلقائياً
- ثم محاولة التحقق مرة أخرى

### 2. تحسين رسائل الخطأ
- رسائل خطأ أوضح بالعربية
- معالجة خاصة للأرقام الاختبارية

## كيفية العمل

1. **عند إدخال الرمز 0000**:
   - يتم التحقق من الرمز
   - إذا كان OTP منتهي الصلاحية، يتم إرسال OTP جديد تلقائياً
   - ثم محاولة التحقق مرة أخرى

2. **للأرقام الاختبارية**:
   - الرمز دائماً `0000`
   - لا حاجة لانتظار SMS حقيقي
   - يعمل مباشرة مع `test_otp` في config.toml

## التحقق من الإعداد

### Local Development:
- تأكد من وجود الرقم في `supabase/config.toml`:
  ```toml
  [auth.sms.test_otp]
  966551111111 = "0000"
  966552222222 = "0000"
  ```

### Production (Supabase Cloud):
1. اذهب إلى Supabase Dashboard
2. Authentication → Settings → SMS
3. أضف في Test OTP:
   ```
   966551111111 = 0000
   966552222222 = 0000
   ```

## استكشاف الأخطاء

إذا استمرت المشكلة:

1. **تحقق من Console Logs**:
   - ابحث عن `TEST PHONE` logs
   - تحقق من `verifyOtp` success/failure

2. **تحقق من config.toml**:
   - تأكد من وجود الرقم في `test_otp`
   - تأكد من تنسيق الرقم (966551111111)

3. **في Production**:
   - أضف الرقم في Supabase Dashboard
   - أو استخدم رقم جوال حقيقي

## ملاحظات

- للأرقام الاختبارية، الرمز دائماً `0000`
- لا حاجة لانتظار SMS
- يعمل مباشرة مع `test_otp`
