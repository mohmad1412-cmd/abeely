# وثيقة متطلبات المنتج (PRD) - منصة ServiceLink AI (أبيلي)

## 1. الملخص التنفيذي
**أبيلي (Abeely)** هي منصة "سوق عكسي" حيث يقوم المستخدمون بنشر طلبات للمنتجات أو الخدمات، ويقدم المزودون (البائعون/مقدمو الخدمات) عروضاً لتلبيتها. تعتمد المنصة على الذكاء الاصطناعي لتسهيل إنشاء الطلبات (عبر النص) وتستخدم خوارزميات المطابقة الذكية لربط المستخدمين بالمزودين المناسبين. تم تصميم التطبيق بنهج "الموبايل أولاً" (Mobile-First)، مع واجهة مستخدم غنية ومتحركة وموطنة بالكامل للسوق السعودي (لغة عربية/RTL).

## 2. أدوار المستخدمين

### 2.1. الضيف (الزائر)
*   **الوصف:** مستخدم غير مسجل يتصفح المنصة.
*   **القدرات:**
    *   عرض "السوق" (صفحة الاكتشاف) مع تفاعل محدود.
    *   إنشاء طلب (يتطلب التحقق من رقم الجوال عبر OTP للإرسال النهائي).
    *   تبديل الوضع الليلي/النهاري واللغة.
    *   عرض الصفحات الثابتة (الشروط، الخصوصية).
*   **القيود:** لا يمكنه تقديم عروض، أو الدردشة، أو عرض تفاصيل المزود الكاملة دون تسجيل الدخول.

### 2.2. المستخدم المسجل (طالب/مزود)
*   **الوصف:** مستخدم تم التحقق منه عبر رقم الجوال (OTP).
*   **القدرات:**
    *   **وضع الطالب (Requester):** إنشاء الطلبات، إدارة "طلباتي"، عرض العروض المستلمة، الدردشة مع المزودين، قبول/رفض العروض.
    *   **وضع المزود (Provider):** تصفح السوق، التصفية حسب الاهتمامات، تقديم العروض، إدارة "عروضي"، الدردشة مع مقدمي الطلبات.
    *   **الملف الشخصي:** إدارة المعلومات الشخصية، الاهتمامات (التصنيفات)، والمدن المفضلة.

## 3. الميزات الأساسية والمتطلبات الوظيفية

### 3.1. المصادقة ([AuthPage](file:///c:/dev/copy-of-copy-of-servicelink-ai-platform/components/AuthPage.tsx#97-1128))
*   **الطريقة الأساسية:** رقم الجوال مع رمز التحقق (OTP) (أرقام سعودية +966).
    *   يتم التحقق عبر خدمة `authService`.
*   **الطرق الثانوية:**
    *   **وضع الضيف:** يسمح بالوصول الفوري للتصفح.
    *   **تسجيل الدخول الاجتماعي:** Google/Apple (مطبق تقنياً لكنه **معطل** حالياً في واجهة المستخدم).
*   **القانونية:** الموافقة الإلزامية على الشروط وسياسة الخصوصية أثناء الدخول.

### 3.2. السوق (صفحة الاكتشاف) ([Marketplace.tsx](file:///c:/dev/copy-of-copy-of-servicelink-ai-platform/components/Marketplace.tsx))
*   **العرض:**
    *   **شبكة/قائمة ديناميكية:** تبديل تلقائي بين العرض النصي (للجوال) والشبكي (للشاشات العريضة).
    *   **البطاقات:** تعرض عنوان الطلب، مقتطف من الوصف، الميزانية، الموقع، الوقت، ومعلومات عامة عن الطالب.
*   **التصفية والبحث:**
    *   **جزيرة التصفية الموحدة (Unified Filter Island):** عنصر واجهة عائم يحتوي على البحث والفلاتر.
    *   **البحث الذكي:** بحث نصي في العنوان/الوصف.
    *   **التصنيفات:** تصفية متعددة التحديد بناءً على اهتمامات المستخدم أو الاختيار اليدوي.
    *   **المدن:** تصفية متعددة التحديد (مثل: الرياض، جدة).
    *   **الترتيب:** الأحدث مقابل الأقدم.
    *   **أوضاع العرض:** "كل الطلبات" مقابل "اهتماماتي" (فلتر ذكي).

### 3.3. إنشاء الطلب (مدعوم بالذكاء الاصطناعي) ([CreateRequestV2.tsx](file:///c:/dev/copy-of-copy-of-servicelink-ai-platform/components/CreateRequestV2.tsx))
*   **طرق الإدخال:**
    *   **النص:** كتابة تفاصيل الطلب مباشرة.
*   **معالجة الذكاء الاصطناعي:**
    *   **المحرك:** Anthropic Claude (عبر Supabase Edge Functions).
    *   **الوظيفة:** تحليل الوصف النصي المدخل لاستخراج **العنوان** واقتراح **التصنيفات** المناسبة فقط.
    *   **الحوار:** يطرح الذكاء الاصطناعي أسئلة توضيحية إذا كانت المعلومات ناقصة (واجهة دردشة تفاعلية).
*   **التحقق:**
    *   **تحقق الضيف:** يجب على الضيوف التحقق من رقم الجوال قبل الإرسال النهائي.
    *   **الإكمال التلقائي للمدن:** فرض اختيار مدينة صحيحة.

### 3.4. لوحة التحكم: طلباتي ([MyRequests.tsx](file:///c:/dev/copy-of-copy-of-servicelink-ai-platform/components/MyRequests.tsx))
*   **الفلاتر:** نشطة، معتمدة، مكتملة، مؤرشفة.
*   **الإجراءات:**
    *   **تعديل:** تعديل تفاصيل الطلب.
    *   **أرشفة/إلغاء أرشفة:** حذف مؤقت/ستعادة الطلبات.
    *   **إخفاء/إظهار:** تبديل الرؤية.
    *   **رفع (Bump):** إعادة الطلب لأعلى القائمة.
*   **مؤشرات الحالة:** شارات مرئية للنشط (أخضر)، المعين/المعتمد (أزرق)، المؤرشف (رمادي).

### 3.5. لوحة التحكم: عروضي ([MyOffers.tsx](file:///c:/dev/copy-of-copy-of-servicelink-ai-platform/components/MyOffers.tsx))
*   **الفلاتر:** الكل، قيد الانتظار، مقبولة، مكتملة/منتهية.
*   **تتبع الحالة:**
    *   **قيد الانتظار (Pending):** تشمل العروض المعلقة وأيضاً العروض التي بدأت عليها مفاوضات (الدردشة).
    *   **مقبول:** قام الطالب بقبول العرض.
    *   **مرفوض:** قام الطالب بقبول عرض آخر.
*   **الإجراءات:**
    *   **واتساب:** الربط يتم بواسطة وكيل آلي (Agent) يقوم بسحب الطلبات وتزويد مقدم العرض المقبول برقم جوال صاحب الطلب للتواصل المباشر.

### 3.6. الإشعارات والمراسلة
*   **الإشعارات داخل التطبيق:** تنبيهات فورية للعروض الجديدة، العروض المقبولة، ورسائل الدردشة.
*   **الدردشة:** نظام مراسلة مدمج بين الطالب والمزود (مرتبط بطلب/عرض محدد).

## 4. واجهة المستخدم وتجربة المستخدم (UI/UX)
*   **إطار العمل:** React + TailwindCSS.
*   **الرسوم المتحركة:** استخدام مكثف لـ `Framer Motion` من أجل:
    *   انتقالات الصفحات.
    *   تفاعلات الأزرار (مثل: الاهتزاز عند التعطيل).
    *   حالات التحميل (الهياكل العظمية Skeletons، النبضات).
    *   العناصر العائمة (جزيرة الفلتر، الكرة العائمة).
*   **السمة (Theme):**
    *   دعم أصلي للوضع الليلي/النهاري.
    *   تخطيط ومنطق RTL (من اليمين لليسار) قياسي للغة العربية.
*   **التجاوب:**
    *   **الجوال:** شريط تنقل سفلي.
    *   **سطح المكتب:** شريط تنقل جانبي أيمن (`md:pr-72`).

## 5. البنية التقنية
*   **الواجهة الأمامية:** Vite (React + TypeScript).
*   **الواجهة الخلفية:** Supabase (PostgreSQL).
*   **الذكاء الاصطناعي/Edge:** دوال Supabase Edge (`ai-chat`, `analyze-request`) تغلف واجهات برمجة تطبيقات Anthropic/OpenAI.
*   **إدارة الحالة:** React Context + Local State.
*   **الخرائط/الموقع:** تكامل منصة خرائط جوجل (خدمة الأماكن).

## 6. اعتبارات مستقبلية (تم تحديدها في الكود)
*   **المدفوعات:** توجد مراجع نائبة (Placeholders)، من المحتمل أن تكون الوحدة الرئيسية التالية.

---
*إصدار الوثيقة: 1.2 | محدثة بناءً على ملاحظات المستخدم*
